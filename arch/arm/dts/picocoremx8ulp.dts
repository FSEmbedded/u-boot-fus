// SPDX-License-Identifier: GPL-2.0
/*
* Copyright 2024 F&S Elektronik Systeme GmbH
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License version 2 as
* published by the Free Software Foundation.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*/

/dts-v1/;

/* Cortex-M is always supported */
#define CONFIG_PICOCOREMX8ULP_REV 110

#if CONFIG_PICOCOREMX8ULP_REV >= 120
/* Network */
/* WLAN/BLUETOOTH */
#define CONFIG_PICOCOREMX8ULP_WLAN
#define CONFIG_PICOCOREMX8ULP_BLUETOOTH

/* ETHERNET */
#define CONFIG_PICOCOREMX8ULP_ETH_PHY

/* AUDIO */
#define CONFIG_PICOCOREMX8ULP_AUDIO

/* I2C_INT */
#define CONFIG_PICOCOREMX8ULP_I2C_INT_RTD
// #define CONFIG_PICOCOREMX8ULP_I2C_INT_APD

/* GPIO */
#define CONFIG_PICOCOREMX8ULP_GPIO_EXP

/* Camera support */
#define CONFIG_PICOCOREMX8ULP_CSI

/* RTC Support */
#define CONFIG_PICOCOREMX8ULP_EXT_RTC
#define CONFIG_PICOCOREMX8ULP_INT_RTC

/* EEPROM */
#define CONFIG_PICOCOREMX8ULP_EEPROM

/* SD_A */
#if !defined(CONFIG_PICOCOREMX8ULP_WLAN)
#define CONFIG_PICOCOREMX8ULP_SD_A_SDCARD
// #define CONFIG_PICOCOREMX8ULP_SD_A_8BIT
#endif

#if !defined(CONFIG_PICOCOREMX8ULP_MIPI_DSI)
#define CONFIG_PICOCOREMX8ULP_LVDS
#endif

/* FLEXSPI */
/* TODO: there is no RPMSG LPSPI support yet */
#define CONFIG_PICOCOREMX8ULP_FLEXSPI_USED

#include "picocoremx8ulp.dtsi"
#else /* CONFIG_PICOCOREMX8ULP_REV */
/* TODO: Support of rev 110 or lower will be droped after next release */

/* Network*/
/* ETHERNET */
#define CONFIG_PICOCOREMX8ULP_ETH_PHY

/* WLAN/BLUETOOTH */
#define CONFIG_PICOCOREMX8ULP_WLAN

/* AUDIO */
// #define CONFIG_PICOCOREMX8ULP_AUDIO_APD
// #define CONFIG_PICOCOREMX8ULP_AUDIO_RTD

/*
 * SD_A - External SD port with Card Detect (CD) and Write Protect (WP)
 * On picocoremx8ulp SKIT: external port is Micro-SD card slot with CD but without WP
 */
#if !defined(CONFIG_PICOCOREMX8ULP_WLAN)
#define CONFIG_PICOCOREMX8ULP_SD_A
#define CONFIG_PICOCOREMX8ULP_SD_A_CD
#define CONFIG_PICOCOREMX8ULP_SD_A_WP
#endif
#include "picocoremx8ulp_rev110.dtsi"
#endif

#include <dt-bindings/usb/pd.h>

&fs_uart_a {
	/* DBG UART */
	status = "okay";
};

#if CONFIG_PICOCOREMX8ULP_REV >= 120
&fs_uart_b {
	status = "okay";
};
#else
&fs_uart_d {
	status = "okay";
};
#endif

&fs_uart_c {
	status = "okay";
};

&fs_i2c_a {
	status = "okay";
};

&fs_i2c_b {
	status = "okay";
};

&fs_i2c_c {
	status = "okay";
};

&fs_i2c_d {
	status = "okay";
	ptn5110: tcpc@52 {
		compatible = "nxp,ptn5110";
		reg = <0x52>;
#if CONFIG_PICOCOREMX8ULP_REV >= 120
		interrupt-parent = <&rp_gpiob>;
		interrupts = <14 IRQ_TYPE_LEVEL_LOW>;
#else
		interrupt-parent = <&rp_gpioc>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;
#endif
		port {
			typec_dr_sw: endpoint {
				remote-endpoint = <&usb1_drd_sw>;
			};
		};

		usb_con: connector {
			compatible = "usb-c-connector";
			label = "USB-C";
			power-role = "dual";
			data-role = "dual";
			try-power-role = "sink";
			source-pdos = <PDO_FIXED(5000, 3000,
			PDO_FIXED_USB_COMM)>;
			sink-pdos = <PDO_FIXED(5000, 3000, PDO_FIXED_USB_COMM)
				     PDO_VAR(5000, 20000, 3000)>;
			op-sink-microwatt = <15000000>;
			self-powered;
		};
	};
};

#if CONFIG_PICOCOREMX8ULP_REV < 120
&fs_spi_a {
	status = "okay";

	spidev0: spidev@0 {
		/* use default driver */
		compatible = "lwn,bk4";
		spi-max-frequency = <1000000>;
		reg = <0>;
		status = "okay";
	};
};
#endif

&fs_sdio_a {
	status = "okay";
};

&fs_usb_1 {
	dr_mode = "otg";
	hnp-disable;
	srp-disable;
	adp-disable;
	disable-over-current;
	usb-role-switch;
	status = "okay";

	port {
		usb1_drd_sw: endpoint {
			remote-endpoint = <&typec_dr_sw>;
		};
	};
};

&fs_usb_2 {
	dr_mode = "host";
	power-active-high;
	disable-over-current;
	status = "okay";
};

&fs_bl_pwm {
	status = "okay";
};

&fs_pwm {
	status = "okay";
};
